---
import { getCollection } from 'astro:content';
import Layout from '../../layouts/Layout.astro';

export async function getStaticPaths() {
  const blogPosts = await getCollection('blog');
  return blogPosts.map((post) => ({
    params: { slug: post.slug },
    props: { post },
  }));
}

const { post } = Astro.props;
const { Content } = await post.render();
---

<Layout title={`${post.data.title} - Rayonis Blog`}>
  <header class="sticky top-0 z-50 bg-rayonis-bg/95 backdrop-blur border-b-2 border-rayonis-text py-4 px-6">
    <div class="max-w-4xl mx-auto flex flex-col sm:flex-row justify-between items-center gap-4">
      <a href="/" class="text-3xl font-black font-sans tracking-tighter hover:text-rayonis-pro transition-colors">
        RAYONIS
      </a>

      <nav class="flex items-center gap-4 sm:gap-8 font-mono font-bold text-sm">
          <a href="/" class="hover:underline">HOME</a>
          <a href="/blog/" class="hover:underline text-purple-600">VIBE CODING BLOG</a>
      </nav>
    </div>
  </header>

  <main class="max-w-4xl mx-auto px-6 py-12 min-h-screen">
    
    <!-- Window UI Container -->
    <div class="border-2 border-rayonis-text shadow-neo bg-white rounded-xl overflow-hidden flex flex-col">
        
        <!-- Window Title Bar -->
        <div class="bg-purple-400 border-b-2 border-rayonis-text px-4 py-3 flex justify-between items-center sticky top-0 z-40">
            <div class="flex items-center gap-2">
                <span class="font-mono font-bold text-sm uppercase tracking-wider">Vibe Coding</span>
            </div>
            
            <!-- Close Button (Returns to Blog) -->
            <a href="/blog/" 
               class="w-6 h-6 flex items-center justify-center bg-gray-300 border border-rayonis-text text-black font-bold text-xs hover:bg-red-500 hover:text-white transition-colors shadow-sm active:translate-y-[1px] active:shadow-none"
               aria-label="Close">
                X
            </a>
        </div>

        <!-- Article Content -->
        <article class="p-6 md:p-12">
            <div class="mb-8 text-center">
                <span class="inline-block px-3 py-1 mb-4 text-xs font-mono font-bold uppercase bg-purple-400 border-2 border-rayonis-text shadow-sm rounded-md">
                    Vibe Coding
                </span>
                <h1 class="text-4xl md:text-5xl font-black mb-4 leading-tight">{post.data.title}</h1>
                <div class="flex justify-center items-center gap-4 font-mono text-sm text-gray-600">
                    <time datetime={post.data.date.toISOString()}>
                        {post.data.date.toLocaleDateString('fr-FR', { year: 'numeric', month: 'long', day: 'numeric' })}
                    </time>
                    <span>•</span>
                    <div class="flex gap-2">
                        {post.data.tags.map(tag => (
                            <span class="text-purple-600">#{tag}</span>
                        ))}
                    </div>
                </div>
            </div>

            {post.data.image && (
                <div class="mb-10 border-2 border-rayonis-text shadow-neo rounded-xl overflow-hidden">
                    <img
                        src={post.data.image}
                        alt={post.data.title}
                        class="w-full h-auto object-cover aspect-video"
                    />
                </div>
            )}

            <div class="prose prose-lg prose-gray max-w-prose mx-auto font-sans leading-relaxed
                prose-headings:font-black prose-headings:font-sans prose-headings:text-black
                prose-h2:text-3xl prose-h2:font-black prose-h2:mb-4
                prose-h3:text-gray-500 prose-h3:tracking-wider prose-h3:uppercase prose-h3:font-bold prose-h3:text-sm prose-h3:font-mono prose-h3:mb-2
                prose-p:text-gray-800 prose-p:leading-8
                prose-li:text-gray-800
                prose-strong:text-black prose-strong:font-bold
                prose-code:font-mono prose-code:text-sm prose-code:bg-gray-100 prose-code:px-1 prose-code:py-0.5 prose-code:rounded prose-code:text-purple-700
                prose-pre:bg-gray-900 prose-pre:border-2 prose-pre:border-rayonis-text prose-pre:shadow-sm
                prose-a:text-purple-600 prose-a:font-bold prose-a:no-underline hover:prose-a:underline
            ">
                <Content />
            </div>
        </article>
    </div>
  </main>

  <footer class="border-t-2 border-rayonis-text bg-white py-12 px-6 mt-12">
      <div class="max-w-4xl mx-auto flex justify-between items-center font-mono text-sm">
          <p>&copy; {new Date().getFullYear()} Rayonis. Tous droits réservés.</p>
      </div>
  </footer>
</Layout>
